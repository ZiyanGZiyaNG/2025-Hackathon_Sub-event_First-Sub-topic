<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candy Crush</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans TC', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 500px;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.1em;
        }

        .game-board {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            max-width: 500px;
            width: 100%;
        }

        .candy {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            user-select: none;
        }

        .candy:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
        }

        .candy.selected {
            border: 2px solid white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .candy.matched {
            animation: pop 0.3s ease-out;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(0); }
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* é›£åº¦é¸æ“‡ */
        .difficulty-select {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <button class="home-btn" onclick="window.location.href='TheNamelessServerServe.html'">
        <span>ğŸ </span>
        <span>è¿”å›ä¸»é </span>
    </button>

    <div class="game-header">
        <h1>ğŸ¬ ç³–æœæ¶ˆæ¶ˆæ¨‚</h1>
        <div class="game-stats">
            <div class="stat-item">åˆ†æ•¸: <span id="score">0</span></div>
            <div class="stat-item">æ­¥æ•¸: <span id="moves">0</span>/<span id="maxMoves">30</span></div>
        </div>

        <!-- é›£åº¦é¸æ“‡ -->
        <div class="difficulty-select">
            é›£åº¦ï¼š
            <select id="difficulty" onchange="changeDifficulty(this.value)">
                <option value="easy">fucking easy</option>
                <option value="medium" selected>é€™ä½ ä¹Ÿä¸æœƒ</option>
                <option value="hard">æ­»åª½é›£åº¦</option>
            </select>
        </div>
    </div>

    <div class="game-board" id="gameBoard"></div>

    <div class="controls">
        <button class="control-btn" onclick="resetGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
        <button class="control-btn" onclick="showHelp()">â“ éŠæˆ²èªªæ˜</button>
    </div>

    <script>
        const BOARD_SIZE = 8;
        const CANDIES = ['ğŸ¬', 'ğŸ­', 'ğŸ«', 'ğŸª', 'ğŸ§', 'ğŸ©'];
        let score = 0;
        let moves = 0;
        let selectedCandy = null;
        let board = [];

        // é›£åº¦è¨­å®š
        const difficultyConfigs = {
            easy:   { maxMoves: 40, targetScore: 300 },
            medium: { maxMoves: 30, targetScore: 500 },
            hard:   { maxMoves: 20, targetScore: 1500 }
        };
        let currentDifficulty = 'medium';
        let MAX_MOVES = difficultyConfigs[currentDifficulty].maxMoves;
        let TARGET_SCORE = difficultyConfigs[currentDifficulty].targetScore;

        // åˆå§‹åŒ–éŠæˆ²æ¿
        function initializeBoard() {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            board = [];

            for (let i = 0; i < BOARD_SIZE; i++) {
                board[i] = [];
                for (let j = 0; j < BOARD_SIZE; j++) {
                    const candy = document.createElement('div');
                    candy.className = 'candy';
                    candy.dataset.row = i;
                    candy.dataset.col = j;
                    candy.onclick = () => handleCandyClick(candy);
                    
                    // ç¢ºä¿åˆå§‹ç‹€æ…‹æ²’æœ‰ä¸‰å€‹ç›¸é€£çš„ç³–æœ
                    let validCandies;
                    do {
                        validCandies = [...CANDIES];
                        if (i >= 2) {
                            if (board[i-1][j].textContent === board[i-2][j].textContent) {
                                validCandies = validCandies.filter(c => c !== board[i-1][j].textContent);
                            }
                        }
                        if (j >= 2) {
                            if (gameBoard.children[i * BOARD_SIZE + j-1].textContent === 
                                gameBoard.children[i * BOARD_SIZE + j-2].textContent) {
                                validCandies = validCandies.filter(c => 
                                    c !== gameBoard.children[i * BOARD_SIZE + j-1].textContent);
                            }
                        }
                    } while (validCandies.length === 0);

                    candy.textContent = validCandies[Math.floor(Math.random() * validCandies.length)];
                    board[i][j] = candy;
                    gameBoard.appendChild(candy);
                }
            }
        }

        // è™•ç†ç³–æœé»æ“Š
        function handleCandyClick(candy) {
            if (!selectedCandy) {
                selectedCandy = candy;
                candy.classList.add('selected');
            } else {
                const row1 = parseInt(selectedCandy.dataset.row);
                const col1 = parseInt(selectedCandy.dataset.col);
                const row2 = parseInt(candy.dataset.row);
                const col2 = parseInt(candy.dataset.col);

                if (isAdjacent(row1, col1, row2, col2)) {
                    swapCandies(selectedCandy, candy);
                    moves++;
                    document.getElementById('moves').textContent = moves;
                    
                    // æ–°å¢ï¼šæª¢æŸ¥éŠæˆ²ç‹€æ…‹
                    checkGameStatus();

                    // æª¢æŸ¥æ˜¯å¦æœ‰åŒ¹é…
                    setTimeout(() => {
                        if (!checkMatches()) {
                            // å¦‚æœæ²’æœ‰åŒ¹é…ï¼Œäº¤æ›å›ä¾†
                            swapCandies(selectedCandy, candy);
                            moves--;
                            document.getElementById('moves').textContent = moves;
                        }
                    }, 300);
                }

                selectedCandy.classList.remove('selected');
                selectedCandy = null;
            }
        }

        // æª¢æŸ¥å…©å€‹ç³–æœæ˜¯å¦ç›¸é„°
        function isAdjacent(row1, col1, row2, col2) {
            return (Math.abs(row1 - row2) === 1 && col1 === col2) ||
                   (Math.abs(col1 - col2) === 1 && row1 === row2);
        }

        // äº¤æ›å…©å€‹ç³–æœ
        function swapCandies(candy1, candy2) {
            const tempContent = candy1.textContent;
            candy1.textContent = candy2.textContent;
            candy2.textContent = tempContent;
        }

        // æª¢æŸ¥ä¸¦è™•ç†åŒ¹é…
        function checkMatches() {
            let hasMatches = false;
            
            // æª¢æŸ¥æ°´å¹³åŒ¹é…
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE - 2; j++) {
                    if (board[i][j].textContent === board[i][j+1].textContent &&
                        board[i][j].textContent === board[i][j+2].textContent) {
                        board[i][j].classList.add('matched');
                        board[i][j+1].classList.add('matched');
                        board[i][j+2].classList.add('matched');
                        hasMatches = true;
                    }
                }
            }
            
            // æª¢æŸ¥å‚ç›´åŒ¹é…
            for (let i = 0; i < BOARD_SIZE - 2; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (board[i][j].textContent === board[i+1][j].textContent &&
                        board[i][j].textContent === board[i+2][j].textContent) {
                        board[i][j].classList.add('matched');
                        board[i+1][j].classList.add('matched');
                        board[i+2][j].classList.add('matched');
                        hasMatches = true;
                    }
                }
            }

            if (hasMatches) {
                setTimeout(() => {
                    removeMatches();
                }, 300);
                return true;
            }
            return false;
        }

        // ç§»é™¤åŒ¹é…çš„ç³–æœä¸¦å¡«å……æ–°çš„
        function removeMatches() {
            let points = 0;
            
            // è¨ˆç®—åˆ†æ•¸ä¸¦ç§»é™¤åŒ¹é…çš„ç³–æœ
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (board[i][j].classList.contains('matched')) {
                        points += 10;
                        board[i][j].classList.remove('matched');
                        
                        // å¾ä¸Šæ–¹æ‰è½ç³–æœ
                        for (let k = i; k > 0; k--) {
                            board[k][j].textContent = board[k-1][j].textContent;
                        }
                        board[0][j].textContent = CANDIES[Math.floor(Math.random() * CANDIES.length)];
                    }
                }
            }
            
            score += points;
            document.getElementById('score').textContent = score;

            // æ–°å¢ï¼šæª¢æŸ¥éŠæˆ²ç‹€æ…‹
            checkGameStatus();

            // æª¢æŸ¥æ˜¯å¦é‚„æœ‰æ›´å¤šåŒ¹é…
            setTimeout(() => {
                if (checkMatches()) {
                    removeMatches();
                }
            }, 300);
        }

        // é‡ç½®éŠæˆ²
        function resetGame() {
            score = 0;
            moves = 0;
            document.getElementById('score').textContent = score;
            document.getElementById('moves').textContent = moves;
            document.getElementById('maxMoves').textContent = MAX_MOVES;
            selectedCandy = null;
            initializeBoard();
        }

        // é¡¯ç¤ºéŠæˆ²èªªæ˜
        function showHelp() {
            alert(`ğŸ¬ ç³–æœæ¶ˆæ¶ˆæ¨‚éŠæˆ²èªªæ˜

1. é»æ“Šä¸¦äº¤æ›ç›¸é„°çš„ç³–æœ
2. é€£æ¥ä¸‰å€‹æˆ–æ›´å¤šç›¸åŒçš„ç³–æœå¯ä»¥æ¶ˆé™¤
3. æ¶ˆé™¤ç³–æœå¯ä»¥ç²å¾—åˆ†æ•¸
4. æ¯æ¬¡ç§»å‹•éƒ½æœƒè¨ˆç®—æ­¥æ•¸
5. å˜—è©¦ç²å¾—æœ€é«˜åˆ†æ•¸ï¼
6. Yorushikaæ¨çˆ›
7. suisæˆ‘è€å©†
ç¥æ‚¨éŠæˆ²æ„‰å¿«ï¼ ğŸ®`);
        }

        // åˆ‡æ›é›£åº¦
        function changeDifficulty(level) {
            currentDifficulty = level;
            MAX_MOVES = difficultyConfigs[level].maxMoves;
            TARGET_SCORE = difficultyConfigs[level].targetScore;
            document.getElementById('maxMoves').textContent = MAX_MOVES;
            resetGame();
        }

        // æ–°å¢ï¼šæª¢æŸ¥éŠæˆ²æ˜¯å¦å‹åˆ©æˆ–å¤±æ•—
        function checkGameStatus() {
            if (score >= TARGET_SCORE) {
                // ä½¿ç”¨ setTimeout é¿å…èˆ‡ç•«é¢æ›´æ–°è¡çª
                setTimeout(() => {
                    alert(`ğŸ‰ æ­å–œä½ ç²å‹ï¼\nç¸½åˆ†ï¼š${score} åˆ†\nä½¿ç”¨æ­¥æ•¸ï¼š${moves} / ${MAX_MOVES}`);
                    resetGame();
                }, 100);
            } else if (moves >= MAX_MOVES) {
                setTimeout(() => {
                    alert(`ğŸ’€ éŠæˆ²çµæŸï¼\nå·²é”åˆ°æœ€å¤§æ­¥æ•¸ ${MAX_MOVES} æ­¥\nç›®æ¨™åˆ†æ•¸ï¼š${TARGET_SCORE} åˆ†\nä½ çš„åˆ†æ•¸ï¼š${score} åˆ†`);
                    resetGame();
                }, 100);
            }
        }

        // é–‹å§‹éŠæˆ²
        initializeBoard();
    </script>
</body>
</html> 