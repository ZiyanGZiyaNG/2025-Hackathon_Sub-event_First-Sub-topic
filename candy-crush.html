<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candy Crush</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans TC', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 500px;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.1em;
        }

        .game-board {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            max-width: 500px;
            width: 100%;
        }

        .candy {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            user-select: none;
        }

        .candy:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
        }

        .candy.selected {
            border: 2px solid white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .candy.matched {
            animation: pop 0.3s ease-out;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(0); }
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* 難度選擇 */
        .difficulty-select {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <button class="home-btn" onclick="window.location.href='TheNamelessServerServe.html'">
        <span>🏠</span>
        <span>返回主頁</span>
    </button>

    <div class="game-header">
        <h1>🍬 糖果消消樂</h1>
        <div class="game-stats">
            <div class="stat-item">分數: <span id="score">0</span></div>
            <div class="stat-item">步數: <span id="moves">0</span>/<span id="maxMoves">30</span></div>
        </div>

        <!-- 難度選擇 -->
        <div class="difficulty-select">
            難度：
            <select id="difficulty" onchange="changeDifficulty(this.value)">
                <option value="easy">fucking easy</option>
                <option value="medium" selected>這你也不會</option>
                <option value="hard">死媽難度</option>
            </select>
        </div>
    </div>

    <div class="game-board" id="gameBoard"></div>

    <div class="controls">
        <button class="control-btn" onclick="resetGame()">🔄 重新開始</button>
        <button class="control-btn" onclick="showHelp()">❓ 遊戲說明</button>
    </div>

    <script>
        const BOARD_SIZE = 8;
        const CANDIES = ['🍬', '🍭', '🍫', '🍪', '🧁', '🍩'];
        let score = 0;
        let moves = 0;
        let selectedCandy = null;
        let board = [];

        // 難度設定
        const difficultyConfigs = {
            easy:   { maxMoves: 40, targetScore: 300 },
            medium: { maxMoves: 30, targetScore: 500 },
            hard:   { maxMoves: 20, targetScore: 1500 }
        };
        let currentDifficulty = 'medium';
        let MAX_MOVES = difficultyConfigs[currentDifficulty].maxMoves;
        let TARGET_SCORE = difficultyConfigs[currentDifficulty].targetScore;

        // 初始化遊戲板
        function initializeBoard() {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            board = [];

            for (let i = 0; i < BOARD_SIZE; i++) {
                board[i] = [];
                for (let j = 0; j < BOARD_SIZE; j++) {
                    const candy = document.createElement('div');
                    candy.className = 'candy';
                    candy.dataset.row = i;
                    candy.dataset.col = j;
                    candy.onclick = () => handleCandyClick(candy);
                    
                    // 確保初始狀態沒有三個相連的糖果
                    let validCandies;
                    do {
                        validCandies = [...CANDIES];
                        if (i >= 2) {
                            if (board[i-1][j].textContent === board[i-2][j].textContent) {
                                validCandies = validCandies.filter(c => c !== board[i-1][j].textContent);
                            }
                        }
                        if (j >= 2) {
                            if (gameBoard.children[i * BOARD_SIZE + j-1].textContent === 
                                gameBoard.children[i * BOARD_SIZE + j-2].textContent) {
                                validCandies = validCandies.filter(c => 
                                    c !== gameBoard.children[i * BOARD_SIZE + j-1].textContent);
                            }
                        }
                    } while (validCandies.length === 0);

                    candy.textContent = validCandies[Math.floor(Math.random() * validCandies.length)];
                    board[i][j] = candy;
                    gameBoard.appendChild(candy);
                }
            }
        }

        // 處理糖果點擊
        function handleCandyClick(candy) {
            if (!selectedCandy) {
                selectedCandy = candy;
                candy.classList.add('selected');
            } else {
                const row1 = parseInt(selectedCandy.dataset.row);
                const col1 = parseInt(selectedCandy.dataset.col);
                const row2 = parseInt(candy.dataset.row);
                const col2 = parseInt(candy.dataset.col);

                if (isAdjacent(row1, col1, row2, col2)) {
                    swapCandies(selectedCandy, candy);
                    moves++;
                    document.getElementById('moves').textContent = moves;
                    
                    // 新增：檢查遊戲狀態
                    checkGameStatus();

                    // 檢查是否有匹配
                    setTimeout(() => {
                        if (!checkMatches()) {
                            // 如果沒有匹配，交換回來
                            swapCandies(selectedCandy, candy);
                            moves--;
                            document.getElementById('moves').textContent = moves;
                        }
                    }, 300);
                }

                selectedCandy.classList.remove('selected');
                selectedCandy = null;
            }
        }

        // 檢查兩個糖果是否相鄰
        function isAdjacent(row1, col1, row2, col2) {
            return (Math.abs(row1 - row2) === 1 && col1 === col2) ||
                   (Math.abs(col1 - col2) === 1 && row1 === row2);
        }

        // 交換兩個糖果
        function swapCandies(candy1, candy2) {
            const tempContent = candy1.textContent;
            candy1.textContent = candy2.textContent;
            candy2.textContent = tempContent;
        }

        // 檢查並處理匹配
        function checkMatches() {
            let hasMatches = false;
            
            // 檢查水平匹配
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE - 2; j++) {
                    if (board[i][j].textContent === board[i][j+1].textContent &&
                        board[i][j].textContent === board[i][j+2].textContent) {
                        board[i][j].classList.add('matched');
                        board[i][j+1].classList.add('matched');
                        board[i][j+2].classList.add('matched');
                        hasMatches = true;
                    }
                }
            }
            
            // 檢查垂直匹配
            for (let i = 0; i < BOARD_SIZE - 2; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (board[i][j].textContent === board[i+1][j].textContent &&
                        board[i][j].textContent === board[i+2][j].textContent) {
                        board[i][j].classList.add('matched');
                        board[i+1][j].classList.add('matched');
                        board[i+2][j].classList.add('matched');
                        hasMatches = true;
                    }
                }
            }

            if (hasMatches) {
                setTimeout(() => {
                    removeMatches();
                }, 300);
                return true;
            }
            return false;
        }

        // 移除匹配的糖果並填充新的
        function removeMatches() {
            let points = 0;
            
            // 計算分數並移除匹配的糖果
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (board[i][j].classList.contains('matched')) {
                        points += 10;
                        board[i][j].classList.remove('matched');
                        
                        // 從上方掉落糖果
                        for (let k = i; k > 0; k--) {
                            board[k][j].textContent = board[k-1][j].textContent;
                        }
                        board[0][j].textContent = CANDIES[Math.floor(Math.random() * CANDIES.length)];
                    }
                }
            }
            
            score += points;
            document.getElementById('score').textContent = score;

            // 新增：檢查遊戲狀態
            checkGameStatus();

            // 檢查是否還有更多匹配
            setTimeout(() => {
                if (checkMatches()) {
                    removeMatches();
                }
            }, 300);
        }

        // 重置遊戲
        function resetGame() {
            score = 0;
            moves = 0;
            document.getElementById('score').textContent = score;
            document.getElementById('moves').textContent = moves;
            document.getElementById('maxMoves').textContent = MAX_MOVES;
            selectedCandy = null;
            initializeBoard();
        }

        // 顯示遊戲說明
        function showHelp() {
            alert(`🍬 糖果消消樂遊戲說明

1. 點擊並交換相鄰的糖果
2. 連接三個或更多相同的糖果可以消除
3. 消除糖果可以獲得分數
4. 每次移動都會計算步數
5. 嘗試獲得最高分數！
6. Yorushika推爛
7. suis我老婆
祝您遊戲愉快！ 🎮`);
        }

        // 切換難度
        function changeDifficulty(level) {
            currentDifficulty = level;
            MAX_MOVES = difficultyConfigs[level].maxMoves;
            TARGET_SCORE = difficultyConfigs[level].targetScore;
            document.getElementById('maxMoves').textContent = MAX_MOVES;
            resetGame();
        }

        // 新增：檢查遊戲是否勝利或失敗
        function checkGameStatus() {
            if (score >= TARGET_SCORE) {
                // 使用 setTimeout 避免與畫面更新衝突
                setTimeout(() => {
                    alert(`🎉 恭喜你獲勝！\n總分：${score} 分\n使用步數：${moves} / ${MAX_MOVES}`);
                    resetGame();
                }, 100);
            } else if (moves >= MAX_MOVES) {
                setTimeout(() => {
                    alert(`💀 遊戲結束！\n已達到最大步數 ${MAX_MOVES} 步\n目標分數：${TARGET_SCORE} 分\n你的分數：${score} 分`);
                    resetGame();
                }, 100);
            }
        }

        // 開始遊戲
        initializeBoard();
    </script>
</body>
</html> 